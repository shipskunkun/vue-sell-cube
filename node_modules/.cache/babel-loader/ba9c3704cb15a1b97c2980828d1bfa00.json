{"remainingRequest":"/Users/leeco/Documents/vue-sell-cube/node_modules/babel-loader/lib/index.js??ref--16-1!/Users/leeco/Documents/vue-sell-cube/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/leeco/Documents/vue-sell-cube/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/leeco/Documents/vue-sell-cube/node_modules/cube-ui/src/components/upload/upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/cube-ui/src/components/upload/upload.vue","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/leeco/Documents/vue-sell-cube/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Date$now from \"/Users/leeco/Documents/vue-sell-cube/node_modules/@babel/runtime-corejs2/core-js/date/now\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.number.constructor\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UploadBtn from './btn.vue';\nimport UploadFile from './file.vue';\nimport ajaxUpload from './ajax';\nimport btnMixin from './btn-mixin';\nimport { processFiles, newFile, URL, STATUS_READY, STATUS_UPLOADING, STATUS_ERROR, STATUS_SUCCESS } from './util';\nvar COMPONENT_NAME = 'cube-upload';\nvar EVENT_INPUT = 'input';\nvar EVENT_ADDED = 'files-added';\nvar EVENT_SUBMITTED = 'file-submitted';\nvar EVENT_REMOVED = 'file-removed';\nvar EVENT_SUCCESS = 'file-success';\nvar EVENT_ERROR = 'file-error';\nvar EVENT_CLICK = 'file-click';\nexport default {\n  name: COMPONENT_NAME,\n  mixins: [btnMixin],\n  props: {\n    value: {\n      type: Array,\n      default: function _default() {\n        return [];\n      }\n    },\n    action: {\n      type: [String, Object],\n      default: ''\n    },\n    max: {\n      type: Number,\n      default: 10\n    },\n    auto: {\n      type: Boolean,\n      default: true\n    },\n    simultaneousUploads: {\n      type: Number,\n      default: 1\n    },\n    processFile: {\n      type: Function,\n      default: function _default(file, cb) {\n        cb(file);\n      }\n    }\n  },\n  data: function data() {\n    return {\n      files: this.value,\n      paused: !this.auto\n    };\n  },\n  computed: {\n    actionOptions: function actionOptions() {\n      var action = this.action;\n\n      if (typeof action === 'string') {\n        return action ? {\n          target: action\n        } : null;\n      } else {\n        return action;\n      }\n    },\n    isShowBtn: function isShowBtn() {\n      return this.files.length < this.max;\n    }\n  },\n  watch: {\n    value: function value(newVal) {\n      this.files = newVal;\n    },\n    files: function files(newFiles) {\n      this.$emit(EVENT_INPUT, newFiles);\n    }\n  },\n  methods: {\n    addFiles: function addFiles(files) {\n      var _this = this;\n\n      this.$emit(EVENT_ADDED, files);\n      var filesLen = this.files.length;\n      var newFiles = [];\n      var maxLen = this.max - filesLen;\n      var i = 0;\n      var file = files[i];\n\n      while (newFiles.length < maxLen && file) {\n        if (!file.ignore) {\n          newFiles.push(file);\n          this.files.push(newFile());\n        }\n\n        file = files[++i];\n      }\n\n      processFiles(newFiles, this.processFile, function (file, index) {\n        _this.$set(_this.files, filesLen + index, file);\n\n        _this.$emit(EVENT_SUBMITTED, file);\n      }, function () {\n        // waiting ui\n        _this.$nextTick(function () {\n          _this.upload();\n        });\n      });\n    },\n    removeFile: function removeFile(file) {\n      this.$emit(EVENT_REMOVED, file);\n      file._xhr && file._xhr.abort();\n\n      if (file.url) {\n        URL.revokeObjectURL(file.url);\n      }\n\n      var index = this.files.indexOf(file);\n      this.files.splice(index, 1);\n      this.upload();\n    },\n    fileClick: function fileClick(file) {\n      this.$emit(EVENT_CLICK, file);\n    },\n    upload: function upload(retry) {\n      var _this2 = this;\n\n      var options = this.actionOptions;\n\n      if (this.paused || !options) {\n        return;\n      }\n\n      var len = this.files.length;\n      var uploadingCount = 0;\n      var i = 0;\n\n      var _loop = function _loop() {\n        var file = _this2.files[i];\n        var status = file.status;\n\n        if (status === STATUS_READY || retry && status === STATUS_ERROR && file._retryId !== _this2.retryId) {\n          ajaxUpload(file, options, function (file) {\n            if (status === STATUS_ERROR) {\n              file._retryId = _this2.retryId;\n            }\n\n            _this2.$emit(file.status === STATUS_SUCCESS ? EVENT_SUCCESS : EVENT_ERROR, file);\n\n            _this2.upload(retry);\n          });\n          uploadingCount++;\n        } else if (status === STATUS_UPLOADING) {\n          uploadingCount++;\n        }\n\n        i++;\n      };\n\n      while (i < len && uploadingCount < this.simultaneousUploads) {\n        _loop();\n      }\n    },\n    start: function start() {\n      this.paused = false;\n      this.upload();\n    },\n    pause: function pause() {\n      this.paused = true;\n      this.files.forEach(function (file) {\n        if (file.status === STATUS_UPLOADING) {\n          file._xhr.abort();\n\n          file.status = STATUS_READY;\n        }\n      });\n    },\n    retry: function retry() {\n      this.retryId = _Date$now();\n      this.paused = false;\n      this.upload(true);\n    }\n  },\n  components: {\n    UploadBtn: UploadBtn,\n    UploadFile: UploadFile\n  }\n};",{"version":3,"sources":["upload.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"cube-upload\">\n    <slot>\n      <div class=\"cube-upload-def clear-fix\">\n        <upload-file v-for=\"(file, i) in files\" :file=\"file\" :key=\"i\" @click=\"fileClick\"></upload-file>\n        <upload-btn :multiple=\"multiple\" :accept=\"accept\" v-show=\"isShowBtn\"></upload-btn>\n      </div>\n    </slot>\n  </div>\n</template>\n<script type=\"text/ecmascript-6\">\n  import UploadBtn from './btn.vue'\n  import UploadFile from './file.vue'\n  import ajaxUpload from './ajax'\n  import btnMixin from './btn-mixin'\n  import {\n    processFiles,\n    newFile,\n    URL,\n    STATUS_READY,\n    STATUS_UPLOADING,\n    STATUS_ERROR,\n    STATUS_SUCCESS\n  } from './util'\n\n  const COMPONENT_NAME = 'cube-upload'\n  const EVENT_INPUT = 'input'\n  const EVENT_ADDED = 'files-added'\n  const EVENT_SUBMITTED = 'file-submitted'\n  const EVENT_REMOVED = 'file-removed'\n  const EVENT_SUCCESS = 'file-success'\n  const EVENT_ERROR = 'file-error'\n  const EVENT_CLICK = 'file-click'\n\n  export default {\n    name: COMPONENT_NAME,\n    mixins: [btnMixin],\n    props: {\n      value: {\n        type: Array,\n        default() {\n          return []\n        }\n      },\n      action: {\n        type: [String, Object],\n        default: ''\n      },\n      max: {\n        type: Number,\n        default: 10\n      },\n      auto: {\n        type: Boolean,\n        default: true\n      },\n      simultaneousUploads: {\n        type: Number,\n        default: 1\n      },\n      processFile: {\n        type: Function,\n        default: function (file, cb) {\n          cb(file)\n        }\n      }\n    },\n    data() {\n      return {\n        files: this.value,\n        paused: !this.auto\n      }\n    },\n    computed: {\n      actionOptions() {\n        const action = this.action\n        if (typeof action === 'string') {\n          return action ? {\n            target: action\n          } : null\n        } else {\n          return action\n        }\n      },\n      isShowBtn() {\n        return this.files.length < this.max\n      }\n    },\n    watch: {\n      value(newVal) {\n        this.files = newVal\n      },\n      files(newFiles) {\n        this.$emit(EVENT_INPUT, newFiles)\n      }\n    },\n    methods: {\n      addFiles(files) {\n        this.$emit(EVENT_ADDED, files)\n        const filesLen = this.files.length\n        const newFiles = []\n        const maxLen = this.max - filesLen\n        let i = 0\n        let file = files[i]\n        while (newFiles.length < maxLen && file) {\n          if (!file.ignore) {\n            newFiles.push(file)\n            this.files.push(newFile())\n          }\n          file = files[++i]\n        }\n        processFiles(newFiles, this.processFile, (file, index) => {\n          this.$set(this.files, filesLen + index, file)\n          this.$emit(EVENT_SUBMITTED, file)\n        }, () => {\n          // waiting ui\n          this.$nextTick(() => {\n            this.upload()\n          })\n        })\n      },\n      removeFile(file) {\n        this.$emit(EVENT_REMOVED, file)\n        file._xhr && file._xhr.abort()\n        if (file.url) {\n          URL.revokeObjectURL(file.url)\n        }\n        const index = this.files.indexOf(file)\n        this.files.splice(index, 1)\n        this.upload()\n      },\n      fileClick(file) {\n        this.$emit(EVENT_CLICK, file)\n      },\n      upload(retry) {\n        const options = this.actionOptions\n        if (this.paused || !options) {\n          return\n        }\n        const len = this.files.length\n        let uploadingCount = 0\n        let i = 0\n        while (i < len && uploadingCount < this.simultaneousUploads) {\n          const file = this.files[i]\n          const status = file.status\n          if (status === STATUS_READY || (retry && status === STATUS_ERROR && file._retryId !== this.retryId)) {\n            ajaxUpload(file, options, (file) => {\n              if (status === STATUS_ERROR) {\n                file._retryId = this.retryId\n              }\n              this.$emit(file.status === STATUS_SUCCESS ? EVENT_SUCCESS : EVENT_ERROR, file)\n              this.upload(retry)\n            })\n            uploadingCount++\n          } else if (status === STATUS_UPLOADING) {\n            uploadingCount++\n          }\n          i++\n        }\n      },\n      start() {\n        this.paused = false\n        this.upload()\n      },\n      pause() {\n        this.paused = true\n        this.files.forEach((file) => {\n          if (file.status === STATUS_UPLOADING) {\n            file._xhr.abort()\n            file.status = STATUS_READY\n          }\n        })\n      },\n      retry() {\n        this.retryId = Date.now()\n        this.paused = false\n        this.upload(true)\n      }\n    },\n    components: {\n      UploadBtn,\n      UploadFile\n    }\n  }\n</script>\n<style lang=\"stylus\" rel=\"stylesheet/stylus\">\n  @require \"../../common/stylus/variable.styl\"\n  .cube-upload\n    position: relative\n\n  .cube-upload-def\n    margin-right: -10px\n    .cube-upload-btn, .cube-upload-file\n      float: left\n      margin: 0 10px 10px 0\n</style>\n"],"sourceRoot":"node_modules/cube-ui/src/components/upload"}]}